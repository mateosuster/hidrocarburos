---
title: "Series económicas del sector hidrocarburífero argentino"
author:
- affiliation: UNGS/CONICET
  name: Mateo Suster y Juan Kornblihtt
output: html_document
---

```{r setup, include=FALSE}

rm(list =ls())
gc()

knitr::opts_chunk$set(echo = TRUE)

# bibliotecas
library(data.table)
library(tidyverse)
library(knitr)
library(kableExtra)
library(ggplot2)
library(plotly)
library(readxl)
source("functions_hidrocarburos.R")
```

# Variables
```{r}
# datos de variables
data = fread("../resultados/argentina/variables.csv")
variables = unique(data$variable)

glimpse(data)

#TC
tcp_arg <- as.data.table(read_excel("../resultados/argentina/renta_de_la_tierra_hidrocarburifera_arg.xlsx", sheet = "tipo_cambio")) 
tcp_arg = tcp_arg[,!c("sv", "fuente"), with = F]

ipc_us <- as.data.table(read_csv("../data/bls/cpi.csv")) 
setnames(ipc_us,"Year", "anio"  )
ipc_us = ipc_us[, .(ipc_us_20 = mean(Value, na.rm=T)), by = anio]
ipc_us[, ipc_us_20 := generar_indice(serie = ipc_us_20, 
                                    fecha = anio, fecha_base = 2020)]
```

## Producción

Fuentes: 

* [Ministerio de Hacienda, Informes
Sectoriales](https://www.argentina.gob.ar/economia/politicaeconomica/regionalysectorial/informesproductivos) (1998-hoy). 
* [Secretaría de Energía - Regalias](http://datos.minem.gob.ar/dataset/regalias-de-petroleo-crudo-gas-natural-glp-gasolina-y-condensado) (1998-hoy)
* [Secretaría de Energía - SESCO Downstream](http://datos.minem.gob.ar/dataset/produccion-de-petroleo-y-gas-tablas-dinamicas)(1993-hoy)
* [Anuario de combustibles](http://datos.minem.gob.ar/dataset/anuarios-de-combustibles-1950-1999) (1911-1992)
* Kozulj y Pistonesi. Revista  del Instituto de Economía Energética (IDEE) - Fundación Bariloche  (1970 - 1988)
* [EIA](https://www.eia.gov/international/data/country/ARG/petroleum-and-other-liquids/annual-petroleum-and-other-liquids-production?pd=5&p=0000000000000000000000000000000000vg&u=0&f=A&v=mapbubble&a=-&i=none&vo=value&&t=C&g=none&l=249--6&s=94694400000&e=1546300800000) (1980 - 2019)

### Producción de Crudo


La producción de petróleo crudo de largo plazo proviene del Anuario de Combustibles, de la cual contamos datos desde 1911 hasta 1992. Sus valores para el período 1980-1992 coinciden con los de EIA, por lo cual pueden usarse como fuentes alternativas. Asimismo, la evolución de SESCO es similar a la de EIA, salvo por pequeñas divergencias entre 2008 y 2013. La serie de Regalías presenta un nivel menor que las anteriores debido a las deducciones de producción que realizan las empresas para pagar un menor nivel de Regalías hacia las provincias donde realizan la producción. Por último, la serie del Ministerio de Economía coincide con Regalías en sus primeros años, luego presenta un nivel intermedio entre Regalías y SESCO y a partir de 2009 toma a SESCO como fuente. Salvo el Anuario de Combustibles, el resto de las series presentan datos hasta los últimos años. Por lo tanto, el criterio de selección para la serie de producción con la que se realizarán los cálculos es el siguiente:

* Criterio de cómputo para producicón de crudo: 
  + 1911 a 1992: Anuario de combustibles 
  + 1993 - actualidad: SESCO Downstream
  
  
```{r}
prod_crudo_plt <-  ggplot(data[ variable == "Producción de petróleo crudo", ],
                          aes(anio, valor, color = fuente))+
  geom_line()+
  labs(title = "Gráfico 1. Producción de petróleo crudo. Argentina (1911 - 2020)",
       y = "Millones de Barriles",
       x = "Año",
       caption = "Fuente: elaboración propia en base a Anuario de Combustibles, EIA, Ministerio de Economía, Secretaría de Energía (Base Regalías y SESCO)")+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5))+
  # scale_shape_discrete(name = "Fuente")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_y_continuous(labels = scales::unit_format(unit ="", scale = 1e-6))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))

ggplotly(prod_crudo_plt) %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )

```
```{r}
as.data.frame(dcast(data[ variable == "Producción de petróleo crudo", ] , 
      anio ~ fuente, value.var = "valor"))  %>%
  kable(caption = "Tabla 1. Producción de petróleo crudo en Argentina según distintas fuentes (barriles)",
        knitr.kable.NA = "", booktabs = TRUE)  %>%
  # kable_styling(bootstrap_options = c("striped"))
  kable_styling(latex_options = "repeat_header", repeat_header_text = "Table 2 cont.")

# library(htmlTable)
# htmlTable(dcast(data[ variable == "Producción de petróleo crudo", ] , 
#       anio ~ fuente, value.var = "valor"),
#           # cgroup = c("Set 1:25", "Set 26:50"),
#           # n.cgroup = c(2, 2),
#           # rnames = FALSE
#       )
```

### Producción de Gas Natural

Al igual que en la producción de petróleo crudo, la serie de largo plazo de producción de gas proviene del Anuario de Combustibles, de la cual contamos datos desde 1913 hasta 1992. A diferencia del crudo, sus valores para el período 1980-1992 no coinciden con los de EIA, pero está última sí coincide con los de Regalías entre 1999 y 2015. En cambio, la serie de SESCO, tiende a continuar la evolución de EIA y Regalías, pero con el nivel del Anuario de Combustibles, por lo que ambos pares de series pueden empalmar coherentemente según su nivel. Nuevamente, los valores de la base de Regalías son menores debido a las deducciones de producción para tributar menos regalías. La serie del Ministerio de Economía toma los valores de SESCO.Por lo tanto, el criterio de selección para la serie de producción de gas para los cálculos es el siguiente:

* Criterio de cómputo de la producción de gas:
  + 1911 a 1992: Anuario de combustibles 
  + 1993 en adelante: SESCO Downstream
  
  
```{r}

prod_gas_plt <-  ggplot(data[ variable == "Producción de gas natural", ],
                          aes(anio, valor, color = fuente))+
  geom_line()+
  labs(title = "Gráfico 2. Producción de gas. Argentina (1913 - 2020)",
       y = "MMBTU", x = "Año",
       caption = "Fuente: elaboración propia en base a Anuario de Combustibles, EIA, Ministerio de Economía, Secretaría de Energía (Base Regalías y SESCO)")+
  scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )


ggplotly(prod_gas_plt) %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )
```
```{r}
as.data.frame(dcast(data[ variable == "Producción de gas natural", ] , 
      anio ~ fuente, value.var = "valor"))  %>%
  kable(caption = "abla 2. Producción de gas natural en Argentina según distintas fuentes (MMBTU)",
        knitr.kable.NA = "", booktabs = TRUE)  %>%
  # kable_styling(bootstrap_options = c("striped"))
  kable_styling(latex_options = "repeat_header", repeat_header_text = "Table 2 cont.")
```

## Precio Mercado Interno

  Fuentes: 

* [Base Ministerio de Hacienda, Informes
Sectoriales](https://www.argentina.gob.ar/economia/politicaeconomica/regionalysectorial/informesproductivos)
* [Secretaría de Energía-Regalias](http://datos.minem.gob.ar/dataset/regalias-de-petroleo-crudo-gas-natural-glp-gasolina-y-condensado)
  + Por ausencia de información, el precio de regalias entre 1993 y 1998 es el precio total (es decir, es un ponderado que incluye también el precio del mercado externo). En los años posteriores, dicho precio sí corresponde al del mercado interno.  
* Kozulj y Pistonesi. Revista  del Instituto de Economía Energética (IDEE) - Fundación Bariloche  (1970 - 1988). Precio oficial interno de la cuenca neuquina a tasa de cambio oficial. Las fuentes utilizadas de esta revista son Secretaria de Energía, YPF, Gas del Estado, Boletin Informativo de Techint y series propias de IDEE
* Memoria Anual y balances contables de YPF (varios años). Precio intero promedio resultante de la relación entre ventas y cantidades producidas.


####  Precio Mercado Interno de Crudo

* Criterio para precio_crudo: 
  + 1963 a 1965: Kozulj y Pistonesi - Revista IDEE ajustado con el índice del precio del Anuario de YPF 
  + 1989 a 1991: Anuario de YPF
  + 1966 a 1988: Kozulj y Pistonesi - Revista IDEE
  + 1992: MECON ajustado con la variación del Índice de precios internos al por mayor (IPIM)
  + 1993 en adelante: MECON 
 
```{r}

precio_crudo_plt <-  ggplot(data[ variable == variables[5], ],
                          aes(anio, valor, color = fuente))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico 3. Precios del mercado interno del petróleo crudo. Argentina (1963 - 2020)",
       y = "USD/barril", x = "Año",
       caption = "Fuente: elaboración propia en base a IDEE, Ministerio de Economía, Secretaría de Energía (Base Regalías) y Balances Contables de YPF")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )


ggplotly(precio_crudo_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )

```

**Tabla 3. Precio del mercado interno del petróleo crudo en Argentina según distintas fuentes (barriles)**
```{r echo=FALSE, message=FALSE, warning=FALSE}

```


#### Precio Mercado Interno de Gas Natural
* Precio Mercado Interno de gas:
  + 1963 - 1969 & 1989 - 1992: Anuario de YPF
  + 1970 - 1988:  Kozulj y Pistonesi - Revista IDEE
  + 1993 en adelante: Secretaría de Energía - Base Regalías
  + Años faltantes: [...]
  

```{r}
precio_gas_plt <-  ggplot(data[ variable == variables[6], ],
                          aes(anio, valor, color = fuente))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico 4. Precios del mercado interno del gas natural. Argentina (1963 - 2020)",
       y = "USD/MMBTU", x = "Año",
       caption = "Fuente: elaboración propia en base a IDEE, Ministerio de Economía, Secretaría de Energía (Base Regalías) y Balances Contables de YPF")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(precio_gas_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )
```

<br>
**Tabla 4. Precio del mercado interno del gas natural en Argentina según distintas fuentes (MMBTU)**
```{r}

```


## Precios de Referencia del Mercado Mundial
Precios de exportación desde Argentina, benchmarks y Precios del mercado de EEUU (solo gas, internos y de expo/impo)

* [Secretaría de Energía-Regalias](http://datos.minem.gob.ar/dataset/regalias-de-petroleo-crudo-gas-natural-glp-gasolina-y-condensado)) (2006-hoy)
* [MECON](http://datos.minem.gob.ar/dataset/precio-de-exportacion-de-petroleo-crudo). Serie corta y sin transformaciones
* EIA
  + [Brent](https://www.eia.gov/dnav/pet/hist/RBRTED.htm) (1987-hoy)
  + [WTI](https://www.eia.gov/dnav/pet/hist/rwtcD.htm) (1986-hoy)
  + [Henry Hub](https://www.eia.gov/dnav/ng/hist/rngwhhdd.htm) (1997-hoy)
  + [Precio Gas de Boca de Pozo en EEUU](https://www.eia.gov/dnav/ng/hist/n9190us3A.htm)
* [Inflation Data](https://inflationdata.com/articles/inflation-adjusted-prices/historical-crude-oil-prices-table/) (1946-hoy)
* [Eurostat](https://ec.europa.eu/eurostat/web/energy/data/database)
* Revista IDEE   
  + Precio de Importación de gas natural desde Bolivia (1970-1988)
* [UN Comtrade](https://comtrade.un.org/data/)
  + Precio de Exportación e Importación de gas y crudo (a Bolivia y promedio mundial)
  + El precio impo bolivia de  UN Comtrade cierra, da valores coherentes pero no deberia, dado que la conversión deberia realizarse multiplicando el precio en Mm3 por 1000 y ahí recién realizar la conversión
  

#### Precios de Referencia del Crudo
* Fuentes seleccionadas para el precio de referencia de crudo: 
  + entre 1962 y 1992: precio de exportación argentina de UN Comtrade (clasificación SITC as reported)
  + entre 1993-2001 y 2004-2014: precio de exportación argentina de Mecon
  + entre 2002 y 2003: precio de exportación de Argentina de UN Comtrade (Clasificación HS as reported)
  + 2014 en adelante: precio de exportación argentina de Secretaría de Energía (Regalías)
  + Valores faltantes previos a 1992 (1970 - 1985): Brent (Fuente: Inflation Data)
  
##### Precios de transacciones spot 

```{r}
precio_ref_crudo_plt <-  ggplot(data[ variable == variables[7], ],
                          aes(anio, valor, color = fuente))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico 4. Precios de referencia del mercado mundial del crudo (1946 - 2020)",
       y = "USD/MMBTU", x = "Año",
       caption = "Fuente: elaboración propia en base a EIA e Inflation Data")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(precio_ref_crudo_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )

```
##### Precio de Exportación del Crudo

```{r}
precio_expo_crudo_plt <-  ggplot(data[ variable == variables[8], ],
                          aes(anio, valor, color = fuente))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico #. Precios de exportacion de crudo. Argentina (1964 - 2020)",
       y = "USD/barril", x = "Año",
       caption = "Fuente: elaboración propia en base a Sec. Energía, MECON, UN-Comtrade...")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(precio_expo_crudo_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )
```

  
##### Diferencial de precios  
```{r}
# visualizacion diferencial de precio mdo interno
# ggsave("../resultados/argentina/precio_interno_vs_externo.jpg")

brecha_precio_crudo_plt <-  ggplot(data[ variable %in% variables[c(5,7)], ],
                          aes(anio, valor, color = fuente))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico #. Precio de venta al mercado interno, exportacion y referencias del petróleo crudo (1960 - 2020)",
       y = "USD/barril", x = "Año",
       caption = "Fuente: elaboración propia en base a EIA, Sec. de Energía y MECON")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(brecha_precio_crudo_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )

```

#### Precios de Referencia del Gas

* Criterio de precio_externo_gas:
  + Años 1964 y 1965: Precio de importación de gas proveniente de Bolivia hacia Argentina de UN Comtrade
  + 1966 en adelante: Precio de exportacion de gas desde Bolivia a Argentina de UN Comtrade
  + Datos faltantes para los años previos a 1963 y período 1968-1971
  
  
##### Precios de EEUU y Europa  
```{r}
precio_ref_gas_plt <-  ggplot(data[ (variable %in% variables[9:25])&
                                           (!str_detect(variable, "GNL|LNG|OCDE|importación|exportación") ), ],
                          aes(anio, valor, color = variable))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico #. Precios de referencia del gas natural de EEUU y Europa (1960 - 2020)",
       y = "USD/MMBTU", x = "Año",
       caption = "Fuente: elaboración propia en base a EIA y BP")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(precio_ref_gas_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )


```


```{r}
precio_ref_gas_plt_2 <-  ggplot(data[ (variable %in% variables[9:25])&
                                           (!str_detect(variable, "GNL|LNG|OCDE") )&
                                      (str_detect(variable, "importación|exportación") ), ],
                          aes(anio, valor, color = variable))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico #. Precios de exportación e importación del gas natural de EEUU y Europa (1984 - 2020)",
       y = "USD/MMBTU", x = "Año",
       caption = "Fuente: elaboración propia en base a EIA y BP")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(precio_ref_gas_plt_2)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )

```

##### Precio de Exportación del Gas Natural
```{r}
precio_expo_gas_plt <-  ggplot(data[ (variable %in% variables[31]) , ],
                          aes(anio, valor, color = fuente))+
  geom_line(alpha = 0.8)+
  labs(title = "Gráfico #. Precios de exportación del gas natural. Argentina (1962 - 2020)",
       y = "USD/MMBTU", x = "Año",
       caption = "Fuente: elaboración propia en base a Sec. de Energía, MECON, IDEE y UN-Comtrade")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(precio_expo_gas_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )

```

##### Precio de Importación del Gas Natural
```{r}
precio_impo_gas_plt <-  ggplot(data[ (variable %in% variables[26:30]) , ],
                          aes(anio, valor, color = variable))+#, group =codigo_variable))+
  geom_line(alpha = 0.8 , aes(linetype = fuente))+
  labs(title = "Gráfico #. Precios de importación del gas natural. Argentina (1962 - 2020)",
       y = "USD/MMBTU", x = "Año",
       caption = "Fuente: elaboración propia en base a Sec. de Energía, MECON, IDEE y UN-Comtrade")+
  # scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5) )

ggplotly(precio_impo_gas_plt)  %>%
  layout(legend = list(
      orientation = "h",
         x = 0.1, y = -0.2) )

```



## Exportaciones e Importaciones

* Fuentes
  + [SESCO Downstream](https://datos.gob.ar/dataset/energia-refinacion-comercializacion-petroleo-gas-derivados-tablas-dinamicas)
  + INDEC. PORQUE NO ESTÄ EN EL GRAFICO ???
  + MECON
  + UNComtrade

#### Exportaciones e Importaciones de Crudo
* Exportaciones de Crudo: 
  + 1962 a 1993: UN Comtrade
  + 1994 en adelante: SESCO Downstream
  + Los datos faltantes de SESCO se completaron con MECON
  + Siguen habiendo datos faltantes para los años 1965, 1970-74, 1976-78, 1980-84
  
```{r}

expo_usd_crudo = read.csv("../resultados/data_viz/expo_usd_crudo.csv")
expo_q_crudo = read.csv("../resultados/data_viz/expo_q_crudo.csv")

ggplot(data[ variable == "Exportaciones de petróleo crudo", ],
                          aes(anio, valor, color = fuente))+
  geom_line()+
  labs(title = "Gráfico #. Exportaciones de petróleo crudo. Argentina (1911 - 2020)",
       y = "Millones de Barriles",
       x = "Año",
       caption = "Fuente: elaboración propia en base a Ministerio de Economía, Secretaría de Energía (SESCO), UN-Comtrade")+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5))+
  scale_y_continuous(labels = scales::unit_format(unit ="", scale = 1e-6))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))

ggplot(data[ variable == "Importaciones de petróleo crudo", ],
                          aes(anio, valor, color = fuente))+
  geom_line()+
  labs(title = "Gráfico #. Importaciones de petróleo crudo. Argentina (1911 - 2020)",
       y = "Millones de Barriles",
       x = "Año",
       caption = "Fuente: elaboración propia en base a Ministerio de Economía, Secretaría de Energía (SESCO), UN-Comtrade")+
  theme(legend.position = "bottom", plot.caption = element_text(size = 7.5))+
  scale_y_continuous(labels = scales::unit_format(unit ="", scale = 1e-6))+
  scale_x_continuous(breaks = seq(1910, 2030, by = 10))

expo_q_crudo %>%
  select(-expo_crudo) %>%
  gather(key = fuente, value = valor , 3:ncol(.)) %>%
  ggplot(aes(x = anio, y = valor, color =fuente ))+
  geom_line()

expo_usd_crudo %>%
  select(-expo_crudo) %>%
  gather(key = fuente, value = valor , 3:ncol(.)) %>%
  ggplot(aes(x = anio, y = valor, color =fuente ))+
  geom_line()



```


# Renta Hidrocarburífera Total. En precios constantes, sobre Plusvalía Total y PBI

Existen dos caminos para llegar al monto total de renta de la tierra hidrocarburífera: uno es descontando la ganancia normal de las empresas a la plusvalía total del sector y el otro es por medio de la suma de mecanismos de apropiación.

$$Renta\_hidrocarburífera = PV_{hidrocarburífera} - Gcia\_Normal_{hidrocarburífera}$$
Donde:

* $Gcia\_Normal_{hidrocarburífera}$ = Ganancia Normal del sector hidrocarburífero
* $PV_{hidrocarburífera}$ = Plusvalía del sector hidrocarburífero  

$$Gcia\_Normal_{hidrocarburífera} = KTA_{hidrocarburífero} * TG_{referencia}$$


Donde:

* $KTA_{hidrocarburos}$ = Stock de capital adelantado del sector hidrocarburífero 
* $TG_{referencia}$ = Tasa de ganancia normal de referencia.

En este caso, seleccionamos la tasa de ganancia del sector industrial como parámetro para diferenciar la renta de la ganancia. A su vez, para el capital total adelantado de las empresas hidrocarburíferas, seleccionamos unicamente el valor resultante de la estimación de la PPyE de Bolsar, por lo que le faltan los inventarios y salarios adelantados.

El cálculo de renta total hidrocarburífera que se obtiene por medio de descontar la ganancia normal a la plusvalía total del sector, debe ser igual a la renta obtenida por medio de la agregación de los distintos mecanismos de apropiación. Es decir:

$$Renta\_hidrocarburífera = Renta\_diferencial\_precios + Renta\_sobrevaluación + Renta\_empresas + Impuestos\_netos\_específicos $$
$$Impuestos\_netos\_específicos = Retenciones + Regalías - Subsidios$$


```{r}
renta_pextq = read_excel("../resultados/argentina/renta_de_la_tierra_hidrocarburifera_arg.xlsx", sheet = "RTPG_PextQ") %>% 
  select(anio ,unidad, valor = Rtt) %>% 
  mutate(var = "Renta por descuentos sobre plusvalía")

renta_mecanismos = read_excel("../resultados/argentina/renta_de_la_tierra_hidrocarburifera_arg.xlsx", sheet = "RTPG_mecanismos") %>% 
  select(anio ,unidad, valor = Rtt) %>% 
  mutate(var = "Renta por suma de mecanismos")


renta_arg = as.data.table(rbind(renta_pextq, renta_mecanismos))

merge_func <- function(...) merge(..., all.x = T, by = "anio")

renta_usd = Reduce(merge_func, list(renta_arg, tcp_arg, ipc_us))
renta_usd[, valor := ((valor/1e6)/TCp)/ipc_us_20]
renta_usd[, unidad := "Millones de USD TCp de 2020"]
# renta_usd = merge(renta_usd, tcp_arg, by = "anio", all.x= T)

renta_plot1 = ggplot(renta_usd[anio > 1995], aes(anio, valor, color = var))+
  geom_line()+
  labs(title = "Renta hidrocarburífera total de Argentina",
       subtitle = "Comparación de estimaciones propias",
       y = "Millones de USD TCp de 2020")+
  # scale_y_continuous(breaks = seq(0, 60*1e4, 10*1e4))
  scale_y_continuous(breaks = seq(0, 60000, 10000))
renta_plot1 = plot_theme(renta_plot1)+theme(legend.title = element_blank(),
                              axis.title.x = element_blank())

ggsave( filename = "../resultados/argentina/renta_mecanismos_y_pxq_ARG.png", 
        renta_plot1, width = 12, height = 10)
renta_plot1
```

```{r}
renta_pextq_pbi = read_excel("../resultados/argentina/renta_de_la_tierra_hidrocarburifera_arg.xlsx", sheet = "RTPG_PextQ_vs_pib") %>% 
  mutate(var = "Renta por descuentos sobre plusvalía")

renta_mecanismos_pbi = read_excel("../resultados/argentina/renta_de_la_tierra_hidrocarburifera_arg.xlsx", sheet = "RTPG_mecanismos_vs_pib") %>% 
  mutate(var = "Renta por suma de mecanismos")

renta_pbi = as.data.table(rbind(renta_pextq_pbi, renta_mecanismos_pbi))
renta_pbi = renta_pbi[, !"unidad", with=F]
renta_pbi = melt(renta_pbi, id.vars = c("anio", "var"))

renta_plot2 = ggplot(renta_pbi, aes(anio, value, color = var))+
  geom_line()+
  facet_wrap(~variable, ncol =1)+
  scale_y_continuous(labels = scales::percent_format(accuracy = 2))+
  scale_x_continuous(breaks = seq(1960, 2020, 5))
renta_plot2 = plot_theme(renta_plot2)+theme(legend.title = element_blank(),
                              axis.title.x = element_blank(),
                              axis.text.x = element_text(angle = 45,
                                                         vjust= 0.7, hjust= 0.5),
                              axis.title.y = element_blank())
renta_plot2
```
```{r}
renta_mecanismos = as.data.table(read_excel("../resultados/argentina/renta_de_la_tierra_hidrocarburifera_arg.xlsx", sheet = "RTPG_mecanismos"))
 
renta_mecanismos = renta_mecanismos[,!c("Rtt", "IPC_18", "unidad"), with = F] 
renta_mecanismos[, Subs := Subs *-1]
renta_mecanismos = melt(renta_mecanismos, id.vars = "anio",
                        variable.name = "tipo_renta",
                        value.name = "valor")
renta_mecanismos = Reduce(merge_func, list(renta_mecanismos, tcp_arg, ipc_us))
renta_mecanismos[, valor := ((valor/1e6)/TCp)/ipc_us_20]
renta_mecanismos[, unidad := "Millones de USD TCp de 2020"]

renta_plot3 = ggplot(renta_mecanismos, aes(anio, valor, 
                             color = tipo_renta, fill = tipo_renta))+
  geom_col(position = "stack")+
  theme(legend.position = "bottom")+
  labs(title = "Renta de la tierra hidrocarburífera",
       subtitle = "Cursos de apropiación",
       y = "Millones USD TCc de 2020")+
  scale_x_continuous(breaks = seq(1960, 2020, 5))+
  scale_y_continuous(breaks = seq(0, 50000, 10000),
                     labels=function(x) format(x, big.mark = ".", scientific = FALSE))+
  theme_classic()
renta_plot3 = plot_theme(renta_plot3)+theme(legend.title = element_blank(),
                              axis.title.x = element_blank(),
                              axis.text.x = element_text(angle = 45,
                                                         vjust= 0.7, hjust= 0.5))
renta_plot3
ggsave("../resultados/argentina/renta_mecanismos_tcp.png",renta_plot3)
```

# Comparación con estimación de otros autores
```{r}
#cargo renta autores
renta_autores <- fread("../resultados/argentina/renta_autores.csv") 
renta_autores = merge(renta_autores, ipc_us, all.x=T, by = "anio")
renta_autores[, valor := valor /ipc_us_20]
renta_autores[, unidad := "Millones de USD TCc de 2020"]
renta_autores = renta_autores[,!"ipc_us_20", with=F]
renta_autores = merge(renta_autores, tcp_arg, all.x= T, by = "anio")
renta_autores[,valor := (valor*TCc)/TCp]
renta_autores= renta_autores[, !c("TCc", "TCp"), with = F]

#preproceso renta total
renta_usd = renta_usd[, !c("TCc", "TCp", "ipc_us_20"), with = F]
setnames(renta_usd, "var", "tipo_de_renta")
renta_usd[, autor := "Propia"]

#preproceso renta mecanismos
renta_mecanismos[, autor := "Propia"]
renta_mecanismos = renta_mecanismos[, !c("TCc", "TCp", "ipc_us_20"), with = F]
setnames(renta_mecanismos, "tipo_renta", "tipo_de_renta")
renta_mecanismos = dcast(renta_mecanismos, anio+autor+unidad~tipo_de_renta, value.var = "valor")
renta_mecanismos[, `:=`(renta_diferencial_precios = rowSums(cbind(Rdifp_crudo, Rdifp_gas), na.rm=T),
                        renta_estado_total = rowSums(cbind(Rret, Rreg), na.rm=T),
                        renta_sobrevaluacion = rowSums(cbind(Rsvx_crudo, Rsvx_gas), na.rm=T),
                        Subs = Subs*-1)]
renta_mecanismos= renta_mecanismos[, !c("Rdifp_crudo", "Rdifp_gas",
                                        "Rsvx_crudo", "Rsvx_gas"), with=F]
setnames(renta_mecanismos, c("Rkindv", "Subs", "Rret",  "Rreg"), 
         c("renta_empresas", "subsidios", "retenciones", "regalias") )
renta_mecanismos = melt(renta_mecanismos,id.vars = c("anio", "autor", "unidad"), variable.name = "tipo_de_renta",
     value.name = "valor")
#junto los datos
renta_comparacion = rbind(renta_usd, renta_mecanismos, renta_autores)
```


```{r}
#grafico renta total
graf_renta_total_comparacion = ggplot(data = renta_comparacion[str_detect(tipo_de_renta , "renta_total|Renta por suma de mecanismos") & anio > 1990], 
       aes(anio, valor, color = autor))+
  geom_line()+
  # geom_point()+
  theme(legend.position = "bottom")+
  labs(title = "Renta de la tierra hidrocarburífera total de Argentina",
       subtitle = "Comparación con otras estimaciones",
       y = "Millones de USD TCp de 2020", x="",
       caption = "Nota: en la estimación propia se utilizó la renta por por suma de mecanismos")+
  theme_classic()+
  scale_x_continuous(breaks = seq(1960, 2020, 5))+
  scale_y_continuous(labels=function(x) format(x, big.mark = ".", scientific = FALSE))
graf_renta_total_comparacion =plot_theme( graf_renta_total_comparacion)+theme(
  legend.title = element_blank())
graf_renta_total_comparacion

ggsave("../resultados/argentina/comparacion_autores_usd_tcp.png", graf_renta_total_comparacion,
         width = 10, height = 5)
```

```{r}
#grafico comparacion con otros autores
graf_tipos_renta <- ggplot(data = renta_comparacion[!str_detect(tipo_de_renta, c("renta_total|Renta por descuentos sobre plusvalía|Renta por suma de mecanismos|renta_estado_total"
                                 # "renta_diferencial_precios",
                               ))& anio >1990],
       aes(anio, valor, color = autor))+
  geom_line()+
  geom_point(size = 0.5)+
  geom_hline(yintercept = 0)+
  facet_wrap(~tipo_de_renta, scales = "free_y")+
  labs(title = "Renta de la tierra hidrocarburífera",
       subtitle = "Comparación de estimaciones",
       y = "Millones USD TCp de 2020")+
  scale_x_continuous(breaks = seq(1990, 2020, 5))
# # # ggplotly(graf_tipos_renta, width = 800, height = 600)
graf_tipos_renta = plot_theme(graf_tipos_renta)+theme(
  axis.text.x = element_text(angle = 45, hjust = 1),
  strip.text = element_text(12), legend.title = element_blank() )

graf_tipos_renta
ggsave("../resultados/argentina/comparacion_autores_tipo_renta_usd_tcp.png",
       graf_tipos_renta, width = 16, height = 10)
```

